<div id="admin_dashboard__content" class="col-lg-9">
    <section id="admin_dashboard__dropdowns">
        <div class="btn-group">
            <button type="button" class="btn dropdown-toggle dropdown_placeholder" data-toggle="dropdown"
                aria-haspopup="true" aria-expanded="false">
                {{queryDurationString}}
            </button>
            <div class="dropdown-menu filter_dropdown">
                <a class="dropdown-item" onclick="updateDuration(7)">7 ngày gần nhất</a>
                <a class="dropdown-item" onclick="updateDuration(30)">30 ngày gần nhất</a>
                <a class="dropdown-item" onclick="updateDuration(90)">90 ngày gần nhất</a>
                <a class="dropdown-item" onclick="updateDuration(0)">Toàn thời gian</a>
            </div>
        </div>

        <div class="btn-group">
            <button type="button" class="btn dropdown-toggle dropdown_placeholder" data-toggle="dropdown"
                aria-haspopup="true" aria-expanded="false">
                {{queryProductString}}
            </button>
            <div class="dropdown-menu filter_dropdown">
                <a class="dropdown-item" onclick="updateProduct({id: 0, name:'Mọi đồ uống'})">Mọi đồ uống</a>
                {{#each products}}
                <a class="dropdown-item"
                    onclick="updateProduct({id: {{this._id}}, name: '{{this.name}}'})">{{this.name}}</a>
                {{/each}}
            </div>
        </div>

        <button type='button' class='btn btn-outline filter_button' onclick="updateSalesChart()">
            Xem dữ liệu
        </button>
    </section>

    <section id="admin_dashboard__sales">
        <canvas id="saleChart" width="400" height="200"></canvas>
    </section>

    <section id="admin_dashboard__access">
        <h2>Tỉ lệ truy cập người dùng</h2>
        <canvas id="accessChart" width="400" height="200"></canvas>
        <div id="access_numbers">
            <p>Số lượng người dùng hiện tại: 10000</p>
            <p>Số người đăng ký mới: 1000</p>
        </div>
    </section>

    <section id="admin_dashboard__consume">
        <h2>Mức tiêu thụ người dùng</h2>
        <div style="width: 100%; overflow-x: auto">
            <table id="consume_table" class="table table-striped">
                <thead>
                    <tr>
                        <th scope="col">Mã</th>
                        <th scope="col">Hình ảnh</th>
                        <th scope="col">Tên sản phẩm</th>
                        <th scope="col">Số lượng đã bán</th>
                        <th scope="col">Phần trăm</th>
                    </tr>
                </thead>
                <tbody>
                    {{#each consumeData}}
                    <tr>
                        <td scope="row">{{this._id}}</td>
                        <td>
                            <img src="{{this.image}}" width="40" height="40" class="rounded-circle" />
                        </td>
                        <td>{{this.name}}</td>
                        <td>{{this.sold}}</td>
                        <td>
                            <div class="progress">
                                <div class="progress-bar" role="progressbar" style="width: {{this.percent}}%"
                                    aria-valuenow="20" aria-valuemin="0" aria-valuemax="100">{{this.percent}}%</div>
                            </div>
                        </td>
                    </tr>
                    {{/each}}
                </tbody>
            </table>
        </div>
    </section>

    <button class="btn btn-primary">Xuất excel</button>
</div>

<script>

    var duration = 7;
    var product = 0;

    window.onload = () => {
        const salesData = JSON.parse(`{{{ json salesData }}}`);
        loadSaleChart('{{ queryProductString }}', salesData.labelsData, salesData.salesNumber);
        loadAccessChart();

        const urlParams = new URLSearchParams(window.location.search);
        duration = urlParams.get('duration') || 7;
        product = urlParams.get('product') || 0;
    };

    const updateDuration = (newDuration) => {
        duration = newDuration;
        const durationDropdownPlaceholder = document.querySelector('.btn-group:first-child .dropdown_placeholder');

        if (duration == 0)
            durationDropdownPlaceholder.innerHTML = 'Toàn thời gian';
        else
            durationDropdownPlaceholder.innerHTML = `${duration} ngày gần nhất`;
    }
    const updateProduct = (newProduct) => {
        product = newProduct.id;
        const productDropdownPlaceholder = document.querySelector('.btn-group:nth-child(2) .dropdown_placeholder');

        productDropdownPlaceholder.innerHTML = newProduct.name;
    }
    const updateSalesChart = () => {
        window.location.href = `/?duration=${duration}&product=${product}`;
    }
</script>

<script src="/js/admin_dashboard_saleschart.js"></script>
<script src="/js/admin_dashboard_accesschart.js"></script>